<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caf√© My Capiz | App Pedidos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .capiz-brown { color: #4a3427; }
        .bg-capiz { background-color: #4a3427; }
        .view { min-height: 85vh; }
        .hidden { display: none; }
        .category-card { transition: all 0.2s ease; cursor: pointer; aspect-ratio: 1/1; }
        .category-card:active { transform: scale(0.95); }
    </style>
</head>
<body class="bg-gray-100 pb-32 font-sans">

    <header class="bg-white p-4 text-center shadow-sm sticky top-0 z-50">
        <img src="cafe-my-capiz.PNG" alt="Logo" class="mx-auto w-20 mb-1">
        <h1 class="text-lg font-black capiz-brown uppercase">CAF√â MY CAPIZ</h1>
        <p class="text-[8px] font-bold text-gray-400 uppercase tracking-widest">Desarrollado por VIBRAS POSITIVAS</p>
    </header>

    <section id="view-user" class="view p-6">
        <div class="bg-white p-6 rounded-[2rem] shadow-xl border-t-8 border-orange-500">
            <h2 id="user-title" class="text-xl font-black mb-4 capiz-brown italic uppercase text-center">Datos de Entrega</h2>
            <div class="space-y-4">
                <div>
                    <label class="text-[10px] font-bold text-gray-400 ml-2">TU NOMBRE</label>
                    <input type="text" id="name" placeholder="Ej: Isaac Lopez" class="w-full p-3 bg-gray-50 rounded-xl ring-1 ring-gray-200 outline-none focus:ring-orange-500">
                </div>
                <div>
                    <label class="text-[10px] font-bold text-gray-400 ml-2">DIRECCI√ìN (CAUCASIA)</label>
                    <input type="text" id="address" placeholder="Ej: Barrio Las Ceibas" class="w-full p-3 bg-gray-50 rounded-xl ring-1 ring-gray-200 outline-none focus:ring-orange-500">
                </div>
                <div>
                    <label class="text-[10px] font-bold text-gray-400 ml-2">CELULAR</label>
                    <input type="tel" id="phone" placeholder="Ej: 3207907331" class="w-full p-3 bg-gray-50 rounded-xl ring-1 ring-gray-200 outline-none focus:ring-orange-500">
                </div>
                <button onclick="saveUser()" class="w-full bg-orange-600 text-white font-black py-4 rounded-xl shadow-lg mt-4 uppercase">Guardar y Ver Men√∫</button>
            </div>
        </div>
    </section>

    <section id="view-home" class="view hidden">
        <div class="bg-capiz text-white p-3 flex justify-between items-center px-6 shadow-md border-b border-orange-900">
            <div class="text-left">
                <p class="text-[9px] opacity-70 italic uppercase font-bold">Enviando a:</p>
                <p id="label-address" class="text-xs font-black truncate max-w-[180px]"></p>
            </div>
            <button onclick="editUser()" class="text-[10px] bg-orange-500 text-white px-4 py-1.5 rounded-full font-black uppercase shadow-md border border-white">
                <i class="fas fa-edit"></i> Editar
            </button>
        </div>

        <div class="p-4 grid grid-cols-2 gap-4">
            <div onclick="showCat('‚òï CAFETER√çA')" class="category-card bg-white rounded-3xl p-5 shadow-md border-b-8 border-orange-500 flex flex-col justify-center items-center text-center">
                <i class="fas fa-coffee text-3xl text-orange-500 mb-2"></i>
                <span class="font-black text-[10px] uppercase">Cafeter√≠a</span>
            </div>
            <div onclick="showCat('üç≥ BRUNCH')" class="category-card bg-white rounded-3xl p-5 shadow-md border-b-8 border-amber-700 flex flex-col justify-center items-center text-center">
                <i class="fas fa-utensils text-3xl text-amber-800 mb-2"></i>
                <span class="font-black text-[10px] uppercase">Brunch</span>
            </div>
            <div onclick="showCat('üßá WAFFLES')" class="category-card bg-white rounded-3xl p-5 shadow-md border-b-8 border-yellow-400 flex flex-col justify-center items-center text-center">
                <i class="fas fa-stroopwafel text-3xl text-yellow-500 mb-2"></i>
                <span class="font-black text-[10px] uppercase">Waffles</span>
            </div>
            <div onclick="showCat('ü•§ FR√çAS')" class="category-card bg-white rounded-3xl p-5 shadow-md border-b-8 border-blue-400 flex flex-col justify-center items-center text-center">
                <i class="fas fa-ice-cream text-3xl text-blue-500 mb-2"></i>
                <span class="font-black text-[10px] uppercase">Bebidas Fr√≠as</span>
            </div>
            <div onclick="showCat('üçΩÔ∏è FUERTES')" class="category-card bg-white rounded-3xl p-5 shadow-md border-b-8 border-red-600 flex flex-col justify-center items-center text-center">
                <i class="fas fa-pizza-slice text-3xl text-red-600 mb-2"></i>
                <span class="font-black text-[10px] uppercase">Fuertes</span>
            </div>
            <div onclick="showCat('üç∑ LICORES')" class="category-card bg-white rounded-3xl p-5 shadow-md border-b-8 border-purple-600 flex flex-col justify-center items-center text-center">
                <i class="fas fa-wine-glass text-3xl text-purple-600 mb-2"></i>
                <span class="font-black text-[10px] uppercase">Licores</span>
            </div>
        </div>
    </section>

    <section id="view-menu" class="view hidden p-4">
        <button onclick="showView('home')" class="text-orange-600 font-black text-xs uppercase mb-4"><i class="fas fa-arrow-left"></i> Volver</button>
        <h2 id="cat-title" class="text-lg font-black capiz-brown mb-4 uppercase italic"></h2>
        <textarea id="notes" placeholder="¬øInstrucciones especiales? (Ej: Caf√© sin az√∫car)" class="w-full p-4 text-xs bg-white rounded-2xl mb-4 h-16 outline-none ring-1 ring-gray-200"></textarea>
        <div id="p-list" class="space-y-3"></div>
    </section>

    <div id="cart" class="fixed bottom-20 left-4 right-4 bg-orange-600 text-white p-4 rounded-2xl shadow-2xl flex justify-between items-center hidden z-50">
        <div class="flex items-center gap-2">
            <div class="bg-white text-orange-600 h-8 w-8 flex items-center justify-center rounded-full font-black text-xs" id="c-qty">0</div>
            <span class="text-[9px] font-bold uppercase tracking-tighter">Items</span>
        </div>
        <div class="text-right">
            <p id="c-total" class="text-xl font-black">$0</p>
            <button onclick="sendWhatsApp()" class="text-[9px] font-black uppercase bg-black bg-opacity-20 px-3 py-1 rounded-full">Confirmar Pedido</button>
        </div>
    </div>

    <nav class="fixed bottom-0 w-full bg-white border-t flex justify-around p-3 z-50 shadow-2xl">
        <button onclick="showView('home')" class="text-orange-600 flex flex-col items-center">
            <i class="fas fa-home text-lg"></i><span class="text-[8px] font-bold uppercase mt-1">Inicio</span>
        </button>
        <button onclick="sendWhatsApp()" class="text-gray-400 flex flex-col items-center">
            <i class="fab fa-whatsapp text-lg"></i><span class="text-[8px] font-bold uppercase mt-1">Pedir</span>
        </button>
    </nav>

    <script>
        const menu = {
            '‚òï CAFETER√çA': [
                {id:1, n:'Capuchino con Baileys', p:17000, d:'Caf√©, leche y crema whiskey'},
                {id:2, n:'Caf√© Latte', p:11000, d:'Cremoso y suave'},
                {id:3, n:'Arom√°tica Frutos Rojos', p:8000, d:'Fresa, mora, flor de Jamaica'},
                {id:4, n:'Mocachino', p:13000, d:'Caf√©, chocolate y leche'},
                {id:5, n:'Caf√© Campesino', p:7500, d:'Con aguapanela'},
                {id:6, n:'T√© Chai', p:12400, d:'Especiado'},
                {id:7, n:'Americano Especialidad', p:5500, d:'Espresso y agua'}
            ],
            'üç≥ BRUNCH': [
                {id:8, n:'Desayuno Capiz', p:21900, d:'Huevos, jam√≥n, salchicha, arepa y aguacate'},
                {id:9, n:'Calentado con Chicharr√≥n', p:25000, d:'Arroz, frijol y crocante'},
                {id:10, n:'Sart√©n Mexicano', p:23000, d:'Napolitana, jalape√±o y queso'},
                {id:11, n:'Pancakes Tradicionales', p:19500, d:'Huevos, queso, frutas y miel'},
                {id:12, n:'Bowl de Cabeza de Gato', p:22000, d:'Queso asado, chicharr√≥n, suero'}
            ],
            'WAFFLES': [
                {id:13, n:'Waffle Nutella Capiz', p:22000, d:'Con helado y mucha Nutella'},
                {id:14, n:'Waffle Pan de Bono', p:22000, d:'Masa horneada artesanal'},
                {id:15, n:'Waffle de Ch√≥colo', p:25000, d:'Tocineta y queso coste√±o'},
                {id:16, n:'Waffle Primavera', p:23000, d:'Frutas, helado y salsa de chocolate'},
                {id:17, n:'Waffle de Bu√±uelo', p:27000, d:'Huevos fritos y tocineta'}
            ],
            'ü•§ FR√çAS': [
                {id:18, n:'Malteada de Oreo', p:17000, d:'Frapp√© cremoso'},
                {id:19, n:'Limonada de Coco', p:15000, d:'Natural y refrescante'},
                {id:20, n:'Granizado de Caf√©', p:15000, d:'Frapp√© intenso'},
                {id:21, n:'Soda Frutos Rojos', p:17000, d:'Natural burbujeante'},
                {id:22, n:'Limonada de Vino', p:15000, d:'Mezcla especial Capiz'}
            ],
            'üçΩÔ∏è FUERTES': [
                {id:23, n:'Lasa√±a de Carne', p:32000, d:'Artesanal con mucho queso'},
                {id:24, n:'Combo Alitas x16', p:48000, d:'Salsa a elecci√≥n y papas'},
                {id:25, n:'Pechuga al Ajillo', p:35000, d:'Acompa√±ada de patac√≥n'},
                {id:26, n:'Ca√±√≥n de Cerdo', p:32000, d:'Papas al vapor y ensalada'},
                {id:27, n:'Sandwich de At√∫n', p:28000, d:'Pan masa madre'}
            ],
            'üç∑ LICORES': [
                {id:28, n:'Vino de Corozo Capiz', p:55000, d:'Artesanal local'},
                {id:29, n:'Copa Vino Tinto', p:17000, d:'De la casa'},
                {id:30, n:'Cerveza Heineken', p:7000, d:'Muy fr√≠a'}
            ]
        };

        let cart = {};
        let user = JSON.parse(localStorage.getItem('capiz_user'));
        let logCount = parseInt(localStorage.getItem('vibras_log')) || 0;

        // Carga inicial
        window.onload = () => {
            if(user) {
                showView('home');
                document.getElementById('label-address').innerText = user.address;
            }
        };

        function showView(id) {
            ['user','home','menu'].forEach(v => document.getElementById('view-'+v).classList.add('hidden'));
            document.getElementById('view-' + id).classList.remove('hidden');
            window.scrollTo(0,0);
        }

        function saveUser() {
            const n = document.getElementById('name').value, 
                  a = document.getElementById('address').value, 
                  p = document.getElementById('phone').value;
            if(!n || !a || !p) return alert("Por favor, completa tus datos de entrega");
            user = {name:n, address:a, phone:p};
            localStorage.setItem('capiz_user', JSON.stringify(user));
            document.getElementById('label-address').innerText = a;
            showView('home');
        }

        function editUser() {
            // CORRECCI√ìN: Llenar campos con datos existentes para que no salgan blancos
            document.getElementById('name').value = user.name;
            document.getElementById('address').value = user.address;
            document.getElementById('phone').value = user.phone;
            document.getElementById('user-title').innerText = "Editar Mis Datos";
            showView('user');
        }

        function showCat(c) {
            showView('menu');
            document.getElementById('cat-title').innerText = c;
            const list = document.getElementById('p-list');
            list.innerHTML = '';
            menu[c].forEach(i => {
                const q = cart[i.id] ? cart[i.id].q : 0;
                list.innerHTML += `<div class="bg-white p-5 rounded-[2.5rem] flex justify-between items-center shadow-sm border-l-8 border-orange-500">
                    <div class="flex-1 pr-2"><h4 class="font-bold text-[11px] uppercase">${i.n}</h4><p class="text-[8px] text-gray-400 my-0.5 leading-tight">${i.d}</p><span class="font-black text-orange-600 text-xs">$${i.p.toLocaleString()}</span></div>
                    <div class="flex items-center gap-2 bg-gray-50 p-1.5 rounded-full">
                        <button onclick="upd(${i.id},-1,'${i.n}',${i.p})" class="w-7 h-7 bg-white rounded-full shadow text-xs font-bold">-</button>
                        <span id="q-${i.id}" class="text-xs font-black w-4 text-center">${q}</span>
                        <button onclick="upd(${i.id},1,'${i.n}',${i.p})" class="w-7 h-7 bg-orange-500 text-white rounded-full shadow text-xs font-bold">+</button>
                    </div>
                </div>`;
            });
        }

        function upd(id, ch, n, p) {
            if(!cart[id]) cart[id] = {q:0, n:n, p:p};
            cart[id].q += ch; if(cart[id].q < 0) cart[id].q = 0;
            if(document.getElementById('q-' + id)) document.getElementById('q-' + id).innerText = cart[id].q;
            
            let tot = 0, q = 0;
            for(let k in cart) { tot += cart[k].q * cart[k].p; q += cart[k].q; }
            document.getElementById('cart').classList.toggle('hidden', q === 0);
            document.getElementById('c-qty').innerText = q;
            document.getElementById('c-total').innerText = '$' + tot.toLocaleString();
        }

        function sendWhatsApp() {
            let tot = 0;
            for(let k in cart) { tot += cart[k].q * cart[k].p; }
            
            if(tot === 0) return alert("Socio, el carrito est√° vac√≠o. ¬°Elige algo rico!");
            
            const nt = document.getElementById('notes').value;
            let m = `*PEDIDO CAF√â MY CAPIZ*\nüë§ *Cliente:* ${user.name}\nüìç *Dir:* ${user.address}\nüìû *Cel:* ${user.phone}\n\n`;
            for(let k in cart) { if(cart[k].q > 0) { m += `‚Ä¢ ${cart[k].q}x ${cart[k].n} ($${(cart[k].q * cart[k].p).toLocaleString()})\n`; } }
            m += `\nüìù *Notas:* ${nt || 'Ninguna'}\nüí∞ *TOTAL: $${tot.toLocaleString()}*`;
            
            logCount++; localStorage.setItem('vibras_log', logCount);
            window.location.href = `https://wa.me/573207907331?text=${encodeURIComponent(m)}`;
        }
    </script>
</body>
</html>
